(this["webpackJsonpabstract-art"]=this["webpackJsonpabstract-art"]||[]).push([[0],{20:function(e,t,n){},28:function(e,t,n){"use strict";n.r(t);var r,i=n(0),o=n(7),a=n.n(o),c=(n(20),n(6)),s=n(10),u=n(8),l=n(9),f=n(4),v=n(2);function d(e){return function(t){return e}}function O(e){return function(t){return"".concat(e,"(").concat(t.args.map((function(e){return g(e)})).join(", "),")")}}function p(e){return function(t){return"(".concat(t.args.map((function(e){return g(e)})).join(e),")")}}function g(e){return(t=e.type,h.get(t)).glslEmitter(e);var t}!function(e){e.CONST="CONST",e.CONST_PI="CONST_PI",e.CONST_TAU="CONST_TAU",e.CONST_E="CONST_E",e.CONST_PHI="CONST_PHI",e.VAR_X="VAR_X",e.VAR_Y="VAR_Y",e.VAR_T="VAR_T",e.OP_INV="OP_INV",e.OP_ADD="OP_ADD",e.OP_SUB="OP_SUB",e.OP_MUL="OP_MUL",e.OP_DIV="OP_DIV",e.OP_MOD="OP_MOD",e.OP_ABS="OP_ABS",e.OP_DOT="OP_DOT",e.OP_CROSS="OP_CROSS",e.OP_SQRT="OP_SQRT",e.OP_POW="OP_POW",e.OP_EXP="OP_EXP",e.OP_LOG="OP_LOG",e.OP_LN="OP_LN",e.OP_SIN="OP_SIN",e.OP_COS="OP_COS",e.OP_TAN="OP_TAN",e.OP_FLOOR="OP_FLOOR",e.OP_CEIL="OP_CEIL",e.OP_ROUND="OP_ROUND",e.OP_TRUNC="OP_TRUNC",e.OP_MIN="OP_MIN",e.OP_MAX="OP_MAX",e.OP_CLIP="OP_CLIP",e.OP_WRAP="OP_WRAP",e.OP_USHIFT="OP_USHIFT",e.OP_BLEND="OP_BLEND",e.OP_V="OP_V",e.OP_RGB="OP_RGB",e.OP_BW="OP_BW"}(r||(r={}));var m,P=v.a.of({type:r.CONST,numArgs:0,tokenRegExp:/^-?\d+(\.\d+)?$/,glslEmitter:function(e){return"vec3(".concat(e.name,", ").concat(e.name,", ").concat(e.name,")")}},{type:r.CONST_PI,numArgs:0,tokenLiteral:"pi",glslEmitter:d("PI")},{type:r.CONST_TAU,numArgs:0,tokenLiteral:"tau",glslEmitter:d("TAU")},{type:r.CONST_E,numArgs:0,tokenLiteral:"e",glslEmitter:d("E")},{type:r.CONST_PHI,numArgs:0,tokenLiteral:"phi",glslEmitter:d("PHI")},{type:r.VAR_X,numArgs:0,tokenLiteral:"x",glslEmitter:d("x")},{type:r.VAR_Y,numArgs:0,tokenLiteral:"y",glslEmitter:d("y")},{type:r.VAR_T,numArgs:0,tokenLiteral:"t",glslEmitter:d("t")},{type:r.OP_INV,numArgs:1,tokenLiteral:"inv",glslEmitter:O("inv")},{type:r.OP_ADD,numArgs:2,tokenLiteral:"+",glslEmitter:p("+")},{type:r.OP_SUB,numArgs:2,tokenLiteral:"-",glslEmitter:p("-")},{type:r.OP_MUL,numArgs:2,tokenLiteral:"*",glslEmitter:p("*")},{type:r.OP_DIV,numArgs:2,tokenLiteral:"/",glslEmitter:p("/")},{type:r.OP_MOD,numArgs:2,tokenLiteral:"%",glslEmitter:O("mod")},{type:r.OP_ABS,numArgs:1,tokenLiteral:"abs",glslEmitter:O("abs")},{type:r.OP_DOT,numArgs:2,tokenLiteral:"dot",glslEmitter:O("dotp")},{type:r.OP_CROSS,numArgs:2,tokenLiteral:"cross",glslEmitter:O("cross")},{type:r.OP_SQRT,numArgs:1,tokenLiteral:"sqrt",glslEmitter:O("sqrt")},{type:r.OP_POW,numArgs:2,tokenLiteral:"pow",glslEmitter:O("pow")},{type:r.OP_EXP,numArgs:1,tokenLiteral:"exp",glslEmitter:O("exp")},{type:r.OP_LOG,numArgs:2,tokenLiteral:"log",glslEmitter:O("logb")},{type:r.OP_LN,numArgs:1,tokenLiteral:"ln",glslEmitter:O("log")},{type:r.OP_SIN,numArgs:1,tokenLiteral:"sin",glslEmitter:O("sin")},{type:r.OP_COS,numArgs:1,tokenLiteral:"cos",glslEmitter:O("cos")},{type:r.OP_TAN,numArgs:1,tokenLiteral:"tan",glslEmitter:O("tan")},{type:r.OP_FLOOR,numArgs:1,tokenLiteral:"floor",glslEmitter:O("floor")},{type:r.OP_CEIL,numArgs:1,tokenLiteral:"ceil",glslEmitter:O("ceil")},{type:r.OP_ROUND,numArgs:1,tokenLiteral:"round",glslEmitter:O("round")},{type:r.OP_TRUNC,numArgs:1,tokenLiteral:"trunc",glslEmitter:O("trunc")},{type:r.OP_MIN,numArgs:2,tokenLiteral:"min",glslEmitter:O("min")},{type:r.OP_MAX,numArgs:2,tokenLiteral:"max",glslEmitter:O("max")},{type:r.OP_CLIP,numArgs:1,tokenLiteral:"clip",glslEmitter:O("clip")},{type:r.OP_WRAP,numArgs:1,tokenLiteral:"wrap",glslEmitter:O("wrap")},{type:r.OP_USHIFT,numArgs:1,tokenLiteral:"ushift",glslEmitter:O("ushift")},{type:r.OP_BLEND,numArgs:3,tokenLiteral:"blend",glslEmitter:O("blend")},{type:r.OP_V,numArgs:3,tokenLiteral:"v",glslEmitter:O("rgb")},{type:r.OP_RGB,numArgs:3,tokenLiteral:"rgb",glslEmitter:O("rgb")},{type:r.OP_BW,numArgs:1,tokenLiteral:"bw",glslEmitter:O("bw")}),h=P.toMap().mapKeys((function(e,t){return t.type})),_=h.filter((function(e,t){return void 0!==e.tokenLiteral})).mapKeys((function(e,t){return t.tokenLiteral})),y=P.filter((function(e){return void 0!==e.tokenRegExp}));function b(e){var t=function(e){var t=_.get(e);if(void 0!==t)return t;var n,r=Object(f.a)(y);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(i.tokenRegExp.test(e))return i}}catch(o){r.e(o)}finally{r.f()}}(e);if(t)return{type:m.TERMINAL,val:e,terminalMetadata:t}}function E(e){return/^\s+$/.test(e)}function A(e){return"("===e}function x(e){return")"===e}!function(e){e.PAREN_OPEN="PAREN_OPEN",e.PAREN_CLOSE="PAREN_CLOSE",e.TERMINAL="TERMINAL"}(m||(m={}));var S=function(){function e(t){Object(u.a)(this,e),this.input=void 0,this.index=void 0,this.input=t,this.index=0}return Object(l.a)(e,[{key:"nextChar",value:function(){if(!(this.index>=this.input.length))return this.input.charAt(this.index++)}},{key:"prevChar",value:function(){if(this.index<=0)throw Error("Scan error: prevChar() attempted on scanner at index ".concat(this.index,"."));this.index--}},{key:"skipWhitespace",value:function(){var e;do{e=this.nextChar()}while(void 0!==e&&E(e));return e}},{key:"nextToken",value:function(){var e=this.skipWhitespace();if(void 0!==e){if(A(e))return{type:m.PAREN_OPEN,val:"("};if(x(e))return{type:m.PAREN_CLOSE,val:")"};for(var t,n=!1;!n;){var r=this.nextChar();if(void 0===r||E(r)){n=!0;break}if(A(t=r)||x(t)){this.prevChar(),n=!0;break}e+=r}return b(e)}}}]),e}(),j=n(15);function k(e,t){return Math.floor(function(e,t){if(t<e)throw new Error("Invalid range [".concat(e,", ").concat(t,")"));return e+Math.random()*(t-e)}(Math.floor(e),Math.floor(t)))}function L(e){return k(0,e)}var N=function(){function e(t,n,r){Object(u.a)(this,e),this.type=void 0,this.name=void 0,this.args=void 0,this.size=void 0,this.type=t,this.name=n,this.args=r,this.size=r.map((function(e){return e.size})).reduce((function(e,t){return e+t}),1)}return Object(l.a)(e,[{key:"toString",value:function(){return this.flatten().map((function(e){return e.name})).join(" ")}},{key:"findPath",value:function(e){if(!(e<0||e>=this.size)){if(0===e)return[0];var t,n=e-1,r=1,i=Object(f.a)(this.args);try{var o=function(){var e=t.value,i=r,o=e.findPath(n);if(void 0!==o){var a=o.map((function(e){return e+i}));return{v:[0].concat(Object(j.a)(a))}}n-=e.size,r+=e.size};for(i.s();!(t=i.n()).done;){var a=o();if("object"===typeof a)return a.v}}catch(c){i.e(c)}finally{i.f()}}}},{key:"nearestCommonAncestor",value:function(e,t){var n=this.findPath(e),r=this.findPath(t);if(void 0!==n&&void 0!==r){for(var i=r.length-1,o=n.length-1;o>=0;o--){for(;i>0&&r[i]>n[o];)i--;if(n[o]===r[i])return n[o]}return 0}}},{key:"flatten",value:function(){return v.a.of(this).concat(this.args.flatMap((function(e){return e.flatten()})))}},{key:"get",value:function(e){return this.flatten().get(e)}},{key:"set",value:function(t,n){if(t<0||t>=this.size)return this;if(0===t)return n;var r,i=t-1,o=[],a=Object(f.a)(this.args);try{for(a.s();!(r=a.n()).done;){var c=r.value;o.push(c.set(i,n)),i-=c.size}}catch(s){a.e(s)}finally{a.f()}return new e(this.type,this.name,v.a.of.apply(v.a,o))}},{key:"randomSubExpression",value:function(){return L(this.size)}},{key:"randomSubExpressionAncestorWeighted",value:function(){var e=L(this.size),t=L(this.size);return this.nearestCommonAncestor(e,t)}}]),e}();function R(e){var t=new S(e),n=T(t);return function(e){var t=e.nextToken();if(void 0!==t)throw Error('Parse error: Expected end of expression, found "'.concat(t.val,'"'))}(t),n}function T(e){var t=e.nextToken();if(void 0===t)throw Error("Parse error: Expected expression, found none.");if(t.type===m.PAREN_OPEN){var n=T(e);return function(e,t){var n=e.nextToken();if(void 0===n)throw Error("Parse error: Expected token of type ".concat(t,", found none."));if(n.type!==t)throw Error("Parse error: Expected token of type ".concat(t,", found token of type ").concat(n.type,"."))}(e,m.PAREN_CLOSE),n}if(t.type===m.TERMINAL)return function(e,t){if(e.type!==m.TERMINAL||!e.terminalMetadata)throw Error("Parse error: Invalid TERMINAL token ".concat(e));for(var n=[],r=0;r<e.terminalMetadata.numArgs;r++)n.push(T(t));return new N(e.terminalMetadata.type,e.val,v.a.of.apply(v.a,n))}(t,e);throw Error("Parse error: Unexpected token: ".concat(t,"."))}var I=P.filter((function(e){return 0===e.numArgs})),C=P.filter((function(e){return 0!==e.numArgs}));function w(e){if(e<=0)throw new Error("Invalid random expression depth.");var t;if(void 0===(t=1===e?I.get(Math.floor(Math.random()*I.size)):C.get(Math.floor(Math.random()*C.size))).tokenLiteral)return function(e,t){var n=Math.random()*Math.abs(t-e)+Math.min(e,t);return new N(r.CONST,n.toString(),v.a.of())}(-10,10);for(var n=[],i=0;i<t.numArgs;i++)n.push(w(e-1));return new N(t.type,t.tokenLiteral,v.a.of.apply(v.a,n))}function M(e,t){var n=e.randomSubExpressionAncestorWeighted(),r=t.randomSubExpressionAncestorWeighted();return e.set(n,t.get(r))}var F=function(e,t){return{index:e,selected:!1,textSource:t}},U=function(){for(var e=[],t=0;t<12;t++)e.push(F(t,w(5).toString()));return console.log(e),{pieces:e}},D=Object(s.b)({name:"art",initialState:U(),reducers:{random:function(e){return U()},nextGeneration:function(e){try{return function(e){console.log("STARTING");var t=e.pieces.filter((function(e){return e.selected})).map((function(e){try{return R(e.textSource)}catch(t){return}})).filter((function(e){return void 0!==e})).map((function(e){return e}));if(0===t.length)throw new Error("No parents selected");for(var n=[],r=0;r<12;r++){var i=M(t[Math.floor(Math.random()*t.length)],t[Math.floor(Math.random()*t.length)]);n.push(F(r,i.toString()))}return{pieces:n}}(e)}catch(t){return e}},edit:function(e,t){e.pieces[t.payload.index].textSource=t.payload.newSource},toggleSelected:function(e,t){e.pieces[t.payload.index].selected=!e.pieces[t.payload.index].selected}}}),B=D.actions,V=B.random,H=B.nextGeneration,G=(B.edit,B.toggleSelected),W=function(e){return e.art.pieces},z=D.reducer,X=n(11);function Y(e,t,n){console.log(n);var r=e.createShader(t);return e.shaderSource(r,n),e.compileShader(r),e.getShaderParameter(r,e.COMPILE_STATUS)?r:(console.error("Failed to compile ".concat(t===e.FRAGMENT_SHADER?"FRAGMENT_SHADER":t===e.VERTEX_SHADER?"VERTEX_SHADER":"UNKNOWN SHADER TYPE",":")),console.error(n),console.error(e.getShaderInfoLog(r)),e.deleteShader(r),null)}function q(e,t,n){var r=e.createProgram(),i=Y(e,e.VERTEX_SHADER,n||"precision highp float;\n\nattribute vec2 xy_pos;\nvarying vec2 pos;\nvoid main() {\n    pos = xy_pos;\n    gl_Position = vec4(xy_pos, 0, 1);\n}"),o=Y(e,e.FRAGMENT_SHADER,t||"precision highp float;\n\nvoid main() {\n    gl_FragColor = vec4(1, 0, 1, 1);\n}");return i&&o?(e.attachShader(r,i),e.attachShader(r,o),e.linkProgram(r),e.getProgramParameter(r,e.LINK_STATUS)?r:(console.error("Failed to create GL program:"),console.error(e.getProgramInfoLog(r)),e.deleteProgram(r),null)):(e.deleteProgram(r),null)}var K=n(1);function Q(e){var t=Object(i.useRef)(null),n=Object(i.useRef)(null),r=Object(i.useState)(0),o=Object(X.a)(r,2),a=o[0],c=o[1];Object(i.useEffect)((function(){var e=t.current.getContext("webgl"),n=e.createBuffer(),r=new Float32Array([-1,1,-1,-1,1,1,1,-1]);e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,r,e.STATIC_DRAW)}),[]),Object(i.useEffect)((function(){var r=t.current.getContext("webgl");try{var i=R(e.src),o="#define F_PI 3.14159\n#define F_TAU 6.28318\n#define F_E 2.71828\n#define F_PHI 1.61803\n\n#define PI vec3(F_PI, F_PI, F_PI)\n#define TAU vec3(F_TAU, F_TAU, F_TAU)\n#define E vec3(F_E, F_E, F_E)\n#define PHI vec3(F_PHI, F_PHI, F_PHI)\n\nprecision highp float;\n\n// (x, y) coordinates expected to be varying from [-1, 1]\nvarying vec2 pos;\n// time expected to be varying from [0, 1]\nuniform float time;\n\nvec3 expression(vec3 x, vec3 y, vec3 t);\n\nvec3 inv(vec3 v) {\n    return -v;\n}\n\nvec3 dotp(vec3 a, vec3 b) {\n    return vec3(dot(a, b));\n}\n\nvec3 logb(vec3 x, vec3 b) {\n    return log(x) / log(b);\n}\n\nvec3 round(vec3 v) {\n    return floor(0.5 + v);\n}\n\nvec3 trunc(vec3 v) {\n    return vec3(int(v.x), int(v.y), int(v.z));\n}\n\nvec3 clip(vec3 v) {\n    return max(min(v, 1.0), -1.0);\n}\n\nvec3 wrap(vec3 v) {\n    return mod(v + 1.0, vec3(3.0)) - 1.0;\n}\n\nvec3 ushift(vec3 v) {\n    return (v + 1.0) / 2.0;\n}\n\n// fac * a + (1 - fac) * b\n// TODO: Consider clipping fac to [0, 1]\nvec3 blend(vec3 a, vec3 b, vec3 fac) {\n    return (fac * a) + ((vec3(1.0) - fac) * b);\n}\n\nvec3 rgb(vec3 r, vec3 g, vec3 b) {\n    return vec3(r.x, g.x, b.x);\n}\n\nvec3 bw(vec3 rgb) {\n    return vec3(0.3 * rgb.x + 0.59 * rgb.y + 0.11 * rgb.z);\n}\n\nvoid main() {\n    vec3 x = vec3(pos.x);\n    vec3 y = vec3(pos.y);\n    vec3 t = vec3(time, time, time);\n    vec3 rgb = expression(x, y, t);\n    gl_FragColor = vec4(rgb, 1.0);\n}"+"\nvec3 expression(vec3 x, vec3 y, vec3 t) {\n    return ".concat(g(i),";\n}\n");n.current=q(r,o)}catch(c){console.error(c),n.current=q(r)}r.useProgram(n.current);var a=r.getAttribLocation(n.current,"xy_pos");r.vertexAttribPointer(a,2,r.FLOAT,!1,0,0),r.enableVertexAttribArray(a)}),[e.src]);var s=Object(i.useRef)(0),u=Object(i.useRef)(0),l=Object(i.useCallback)((function(){var t=(performance.now()-u.current)/1e3;c(t%e.periodSeconds/e.periodSeconds),s.current=requestAnimationFrame(l)}),[e.periodSeconds]);return Object(i.useEffect)((function(){return u.current=performance.now(),s.current=requestAnimationFrame(l),function(){cancelAnimationFrame(s.current)}}),[e.src,e.periodSeconds,l]),Object(i.useEffect)((function(){if(void 0!==n){var e=t.current.getContext("webgl");e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight);var r=e.getUniformLocation(n.current,"time");e.uniform1f(r,a),e.drawArrays(e.TRIANGLE_STRIP,0,4)}}),[e.src,a]),Object(K.jsx)("div",{className:"Art",children:Object(K.jsx)("canvas",{ref:t})})}function J(e){var t=Object(c.c)(W),n=Object(c.b)(),r=t.map((function(e,t){return Object(K.jsx)("div",{className:e.selected?"Selected":"Deselected",onClick:function(){return n(G({index:t}))},children:Object(K.jsx)(Q,{src:e.textSource})})}));return Object(K.jsxs)("div",{className:"Gallery",children:[Object(K.jsx)("div",{className:"Instructions",children:Object(K.jsxs)("div",{children:['Select expressions you like by clicking on them. Press "Next generation" to breed the selected expressions together randomly.',Object(K.jsx)("br",{}),'If you don\'t like any of the expressions then press "Random" to get new ones.',Object(K.jsx)("br",{})]})}),Object(K.jsxs)("div",{className:"Controls",style:{display:"flex"},children:[Object(K.jsx)("button",{onClick:function(){return n(V())},children:"Random"}),Object(K.jsx)("button",{onClick:function(){return n(H())},children:"Next generation"})]}),Object(K.jsx)("div",{className:"GalleryFlow",style:{display:"flex",flexWrap:"wrap"},children:r})]})}function $(e){var t=Object(i.useState)(e.initialSrc),n=Object(X.a)(t,2),r=n[0],o=n[1];return Object(K.jsxs)("div",{className:"Editor",children:[Object(K.jsx)(Q,{src:r}),Object(K.jsx)("textarea",{rows:8,value:r,onChange:function(e){o(e.target.value)}})]})}function Z(){return Object(K.jsxs)("div",{children:[Object(K.jsx)(J,{}),Object(K.jsx)("div",{children:"You can write your own expression below. Unfortunately it isn't selectable yet."}),Object(K.jsx)($,{initialSrc:"rgb % t % x y * t * x y / t / x y"}),Object(K.jsxs)("div",{children:[Object(K.jsx)("i",{children:'"This art may not make sense to you. It makes Ness sleepy just thinking about it. Use Paralysis to knock some sense into the painting."'}),Object(K.jsx)("br",{}),"\u2014 EarthBound Player's Guide"]}),Object(K.jsx)("br",{}),Object(K.jsx)("div",{style:{color:"yellow"},children:"UX developer wanted :)"}),Object(K.jsx)("div",{style:{color:"blue"},children:Object(K.jsx)("a",{href:"https://github.com/mbh95/abstract-art",children:"GitHub repo"})})]})}Q.defaultProps={expr:void 0,periodSeconds:5},$.defaultProps={initialSrc:"rgb x y t"};var ee=Object(s.a)({reducer:{art:z}});a.a.render(Object(K.jsx)(c.a,{store:ee,children:Object(K.jsx)(Z,{})}),document.getElementById("root"))}},[[28,1,2]]]);
//# sourceMappingURL=main.8b5e8208.chunk.js.map